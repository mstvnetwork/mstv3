<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MSTV Live TV Channel</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 {
      font-size: 2.5em;
      text-align: center;
      margin-bottom: 10px;
      background: linear-gradient(45deg, gold, orange);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .player-wrapper {
      position: relative;
      width: 100%;
      max-width: 960px;
      aspect-ratio: 16 / 9;
      background: black;
      border: 4px solid gold;
      border-radius: 15px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    #playerFrame {
      width: 100%;
      height: 100%;
    }
    .watermark {
      position: absolute;
      top: 10px;
      left: 10px;
      width: 100px;
      opacity: 0.8;
      pointer-events: none;
    }
    #muteOverlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 70px;
      height: 70px;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
    }
    #muteOverlay svg {
      fill: white;
      width: 40px;
      height: 40px;
    }
    #muteOverlay.hidden {
      display: none;
    }
    .info-bar {
      text-align: center;
      margin-bottom: 10px;
    }
    .info-bar span {
      margin: 0 10px;
    }
    .tv-guide {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      max-width: 960px;
      width: 100%;
    }
    .tv-guide h2 {
      margin-bottom: 10px;
      font-size: 1.2em;
      color: gold;
    }
    .tv-guide-item {
      padding: 5px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
  </style>
</head>
<body>
  <h1>MSTV Live TV Channel</h1>
  <p>Broadcasting your curated content 24/7</p>

  <div class="player-wrapper">
    <div id="playerFrame"><p style="color: white; text-align:center;">Loading player...</p></div>
    <img class="watermark" src="https://i.imgur.com/1wz8yZM.png" alt="Logo" />
    <div id="muteOverlay" title="Click to unmute">
      <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3z"/><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v8.06c1.48-.74 2.5-2.26 2.5-4.03z"/><path d="M19 12c0 2.48-1.51 4.58-3.71 5.4l1.43 1.43C18.29 18.15 20 15.28 20 12s-1.71-6.15-3.28-7.83l-1.43 1.43C17.49 7.42 19 9.52 19 12z"/></svg>
    </div>
  </div>

  <div class="info-bar">
    <span id="status">Loading...</span> |
    <span id="clock"></span> |
    <span id="nowPlaying">Now Playing: -</span> |
    <span id="nextUp">Next: -</span>
  </div>

  <div class="tv-guide">
    <h2>Today's TV Guide</h2>
    <div id="guideList">Loading...</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    const playlistURL = "https://raw.githubusercontent.com/mstvnetwork/mstv3/main/playlist.json";
    const playerFrame = document.getElementById("playerFrame");
    const status = document.getElementById("status");
    const clock = document.getElementById("clock");
    const nowPlaying = document.getElementById("nowPlaying");
    const nextUp = document.getElementById("nextUp");
    const guideList = document.getElementById("guideList");
    const muteOverlay = document.getElementById("muteOverlay");

    let playlist = [];
    let currentIndex = -1;
    let startTime = new Date().setHours(0, 0, 0, 0);

    function formatTime(seconds) {
      const h = String(Math.floor(seconds / 3600)).padStart(2, '0');
      const m = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
      return `${h}:${m}`;
    }

    function updateClock() {
      const now = new Date();
      clock.textContent = now.toLocaleTimeString();
    }

    function isYouTube(url) {
      return /youtu\.be|youtube\.com/.test(url);
    }

    function getYouTubeID(url) {
      const match = url.match(/(?:v=|\/live\/|youtu\.be\/)([^&?/]+)/);
      return match ? match[1] : null;
    }

    function isHLS(url) {
      return url.endsWith('.m3u8');
    }

    function playItem(index) {
      const item = playlist[index];
      if (!item) return;

      const url = item.url;
      const duration = getDuration(item);
      const title = item.title || "Untitled";
      nowPlaying.textContent = `Now Playing: ${title}`;
      nextUp.textContent = `Next: ${playlist[index + 1] ? playlist[index + 1].title : '-'}`;
      status.textContent = "Live";

      if (isYouTube(url)) {
        const id = getYouTubeID(url);
        if (id) {
          playerFrame.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${id}?autoplay=1&mute=1&controls=1&modestbranding=1&rel=0" frameborder="0" allowfullscreen></iframe>`;
        }
      } else if (isHLS(url)) {
        playerFrame.innerHTML = `<video id="videoPlayer" width="100%" height="100%" autoplay muted controls playsinline></video>`;
        const video = document.getElementById("videoPlayer");
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        video.play();
      } else {
        playerFrame.innerHTML = `<video width="100%" height="100%" src="${url}" autoplay muted controls playsinline></video>`;
      }

      showMuteOverlay();
      setTimeout(() => {
        playNext(index, duration);
      }, duration * 1000);
    }

    function getDuration(item) {
      const parts = (item.duration || "00:05:00").split(":").map(Number);
      return parts.length === 3 ? parts[0]*3600 + parts[1]*60 + parts[2] : parts[0]*60 + parts[1];
    }

    function playNext(currentIdx, duration) {
      const nextIdx = currentIdx + 1;
      if (nextIdx < playlist.length) {
        currentIndex = nextIdx;
        playItem(currentIndex);
      }
    }

    function syncPlayback() {
      const now = Date.now();
      const secondsSinceStart = Math.floor((now - startTime) / 1000);
      let running = 0;
      for (let i = 0; i < playlist.length; i++) {
        const dur = getDuration(playlist[i]);
        if (running + dur > secondsSinceStart) {
          currentIndex = i;
          playItem(i);
          break;
        }
        running += dur;
      }
    }

    function renderGuide() {
      guideList.innerHTML = '';
      let running = 0;
      playlist.forEach(item => {
        const dur = getDuration(item);
        const start = formatTime(running);
        const end = formatTime(running + dur);
        guideList.innerHTML += `<div class="tv-guide-item">${start} - ${end} :: ${item.title}</div>`;
        running += dur;
      });
    }

    function showMuteOverlay() {
      muteOverlay.classList.remove("hidden");
    }

    muteOverlay.addEventListener("click", () => {
      const video = document.querySelector("video");
      if (video) {
        video.muted = false;
        video.volume = 1;
      }
      muteOverlay.classList.add("hidden");
    });

    async function init() {
      updateClock();
      setInterval(updateClock, 1000);

      try {
        const res = await fetch(playlistURL);
        const data = await res.json();
        playlist = data.items || data.playlist || data;
        renderGuide();
        syncPlayback();
      } catch (e) {
        status.textContent = "Failed to load playlist";
      }
    }

    init();
  </script>
</body>
</html>
