<!DOCTYPE html>
<html>
<head>
    <title>My Custom YouTube Channel</title>
    <style>
        /* Basic styling for your player */
        body { font-family: sans-serif; text-align: center; margin-top: 50px; background-color: #f0f0f0; }
        h1 { color: #333; }
        #player { margin: 20px auto; width: 640px; height: 390px; background-color: #000; border: 1px solid #ccc; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px; font-size: 1em; }
        button:hover { background-color: #0056b3; }
        #videoTitle { font-size: 1.5em; margin-bottom: 15px; color: #555; }
    </style>
</head>
<body>
    <h1>My Custom YouTube Channel</h1>
    <div id="videoTitle"></div> <div id="player"></div> <button onclick="playPrevious()">Previous</button>
    <button onclick="playNext()">Next</button>
    <button onclick="playRandom()">Play Random</button>

    <script>
        // --- STEP 1: REPLACE THIS URL WITH YOUR ACTUAL RENDER SERVER URL ---
        const renderServerUrl = "https://my-youtube-channel-server.onrender.com"; // <-- IMPORTANT: Change this line!
        // -----------------------------------------------------------------

        let player; // This will hold the YouTube player object
        let playlist = []; // This will store the playlist fetched from your Render server
        let currentVideoIndex = -1; // Keeps track of which video is currently playing

        // 1. Load the YouTube IFrame Player API code.
        // This is YouTube's official script for embedding their player.
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api"; // Official YouTube API URL
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // 2. This function is called by the YouTube API once it's loaded.
        //    It creates the YouTube player with specified playerVars.
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '390',
                width: '640',
                videoId: '', // Player starts empty, we'll load videos via JavaScript
                playerVars: {
                    'autoplay': 1,      // Attempt to autoplay
                    'controls': 0,      // Hide player controls
                    'mute': 1,          // Mute the video (highly recommended for autoplay to work)
                    'disablekb': 1,     // Disable keyboard controls (like spacebar to play/pause)
                    'fs': 0,            // Hide fullscreen button
                    'iv_load_policy': 3,// Hide annotations and cards
                    'modestbranding': 1, // Remove YouTube logo (some branding may remain)
                    'rel': 0            // Don't show related videos at the end
                },
                events: {
                    'onReady': onPlayerReady,           // When the player is ready
                    'onStateChange': onPlayerStateChange // When video starts, ends, pauses etc.
                }
            });
        }

        // 3. This function runs when the player is ready to receive commands.
        async function onPlayerReady(event) {
            console.log("YouTube Player is ready!");
            await fetchAndPopulateVideos(); // Get your video list from your Render server

            // If playlist exists, start playing the first video
            if (playlist.length > 0) {
                currentVideoIndex = 0; // Set index to the first video
                loadAndPlayVideo(playlist[currentVideoIndex].id); // Load and play it
            }
        }

        // 4. This function handles when a video ends (to play the next one automatically).
        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.ENDED) {
                playNext(); // This line automatically calls playNext()
            }
        }

        // 5. Fetches the playlist from your Render server
        async function fetchAndPopulateVideos() {
            try {
                // This fetches data from your Render server's /playlist endpoint
                const response = await fetch(`${renderServerUrl}/playlist`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                playlist = await response.json(); // Store the fetched playlist

                // You could also populate a dropdown here if you wanted a list to select from
                // For now, we just fetch it for sequential/random play.
            } catch (error) {
                console.error("Could not fetch playlist:", error);
                alert("Error loading playlist. Check your Render server URL and ensure it's running.");
            }
        }

        // 6. Loads and plays a specific YouTube video ID
        function loadAndPlayVideo(videoId) {
            if (player && videoId) {
                player.loadVideoById(videoId);
                updateVideoTitle(); // Update the title displayed on the page
            }
        }

        // 7. Updates the title displayed above the player
        function updateVideoTitle() {
            if (currentVideoIndex >= 0 && currentVideoIndex < playlist.length) {
                document.getElementById('videoTitle').textContent = playlist[currentVideoIndex].title;
            } else {
                document.getElementById('videoTitle').textContent = "No video loaded";
            }
        }

        // 8. Functions for player controls (Next, Previous, Random)
        function playNext() {
            if (playlist.length === 0) return;
            currentVideoIndex = (currentVideoIndex + 1) % playlist.length; // Loop back to start
            loadAndPlayVideo(playlist[currentVideoIndex].id);
        }

        function playPrevious() {
            if (playlist.length === 0) return;
            // Handle negative index by adding playlist.length before modulo
            currentVideoIndex = (currentVideoIndex - 1 + playlist.length) % playlist.length;
            loadAndPlayVideo(playlist[currentVideoIndex].id);
        }

        function playRandom() {
            if (playlist.length === 0) return;
            const randomIndex = Math.floor(Math.random() * playlist.length);
            currentVideoIndex = randomIndex;
            loadAndPlayVideo(playlist[currentVideoIndex].id);
        }
    </script>
</body>
</html>
