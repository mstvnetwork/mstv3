<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouTube Playlist Player</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #000;
      color: #fff;
      text-align: center;
      margin: 0; padding: 0;
    }
    #video-container {
      position: relative;
      width: 80%;
      margin: 20px auto;
      height: 360px;
    }
    #yt-player {
      width: 100%;
      height: 100%;
    }
    #mute-icon {
      position: absolute;
      bottom: 10px;
      right: 10px;
      cursor: pointer;
      z-index: 2;
      width: 32px;
      height: 32px;
    }
    #video-info {
      margin-bottom: 10px;
      font-size: 1.2em;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>YouTube Playlist Player</h1>

  <div id="video-info">
    <h2 id="video-title">Loading...</h2>
  </div>

  <div id="video-container">
    <div id="yt-player"></div>
    <img id="mute-icon" src="mute-icon.png" alt="Mute" onclick="toggleMute()" />
  </div>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    const ytPlayerDiv = document.getElementById('yt-player');
    const titleEl = document.getElementById('video-title');
    const muteIcon = document.getElementById('mute-icon');

    // Playlist of YouTube URLs with titles
    const playlist = [
      { url: "https://www.youtube.com/watch?v=-HT3JdpKUCQ", title: "YouTube Live Stream 1" },
      { url: "https://www.youtube.com/watch?v=ysz5S6PUM-U", title: "YouTube Video 2" },
      { url: "https://youtu.be/dQw4w9WgXcQ", title: "YouTube Video 3" }
    ];

    let currentIndex = 0;
    let ytPlayer = null;
    let ytReady = false;
    let isYouTubeMuted = true;
    let isUserInteracted = false;

    // Restore saved index/time if available
    const savedIndex = parseInt(localStorage.getItem("videoIndex"));
    const savedTime = parseFloat(localStorage.getItem("videoTime"));

    if (!isNaN(savedIndex) && savedIndex < playlist.length) {
      currentIndex = savedIndex;
    }

    function extractYouTubeID(url) {
      if (url.includes("youtu.be/")) {
        return url.split("youtu.be/")[1].split(/[?&]/)[0];
      } else if (url.includes("v=")) {
        return url.split("v=")[1].split("&")[0];
      }
      return "";
    }

    function updateInfo(item) {
      titleEl.textContent = item.title || "Now Playing";
    }

    function loadVideo(index) {
      if (index >= playlist.length) index = 0;
      currentIndex = index;
      localStorage.setItem("videoIndex", index);
      localStorage.setItem("videoTime", "0");
      const item = playlist[index];
      updateInfo(item);

      const videoId = extractYouTubeID(item.url);

      if (ytPlayer) {
        ytPlayer.loadVideoById(videoId);
        if (isYouTubeMuted) {
          ytPlayer.mute();
        } else {
          ytPlayer.unMute();
        }
        if (!isNaN(savedTime)) ytPlayer.seekTo(savedTime, true);
        ytPlayer.playVideo();
        monitorYouTubeEnd();
      }
    }

    function monitorYouTubeEnd() {
      if (!ytPlayer || !ytPlayer.getDuration) return;
      clearInterval(window.ytMonitorInterval);
      window.ytMonitorInterval = setInterval(() => {
        const duration = ytPlayer.getDuration();
        const current = ytPlayer.getCurrentTime();
        const state = ytPlayer.getPlayerState();

        localStorage.setItem("videoTime", current);

        // Consider video ended if less than 1.5s left and playing
        if (state === YT.PlayerState.PLAYING && duration - current <= 1.5) {
          clearInterval(window.ytMonitorInterval);
          nextVideo();
        }
      }, 1000);
    }

    function nextVideo() {
      currentIndex = (currentIndex + 1) % playlist.length;
      localStorage.setItem("videoIndex", currentIndex);
      localStorage.setItem("videoTime", "0");
      loadVideo(currentIndex);
    }

    function toggleMute() {
      isUserInteracted = true;
      if (!ytPlayer || !ytReady) return;

      if (isYouTubeMuted) {
        ytPlayer.unMute();
        isYouTubeMuted = false;
        muteIcon.src = "unmute-icon.png"; // Your unmute icon path here
      } else {
        ytPlayer.mute();
        isYouTubeMuted = true;
        muteIcon.src = "mute-icon.png"; // Your mute icon path here
      }
    }

    function onYouTubeIframeAPIReady() {
      ytReady = true;
      ytPlayer = new YT.Player('yt-player', {
        height: '360',
        width: '640',
        videoId: extractYouTubeID(playlist[currentIndex].url),
        playerVars: {
          autoplay: 1,
          controls: 1,
          mute: 1,
          rel: 0
        },
        events: {
          'onReady': (event) => {
            isYouTubeMuted = true;
            event.target.mute();
            if (!isNaN(savedTime)) {
              event.target.seekTo(savedTime, true);
            }
            event.target.playVideo();
            updateInfo(playlist[currentIndex]);
            monitorYouTubeEnd();
          },
          'onStateChange': function (event) {
            if (event.data === YT.PlayerState.ENDED) {
              clearInterval(window.ytMonitorInterval);
              nextVideo();
            }
          },
          'onError': () => nextVideo()
        }
      });
    }

    // Allow unmute only after user interacts anywhere on page
    window.addEventListener('click', () => {
      if (!isUserInteracted && ytReady) {
        ytPlayer.unMute();
        isYouTubeMuted = false;
        muteIcon.src = "unmute-icon.png";
        isUserInteracted = true;
      }
    }, { once: true });

  </script>

</body>
</html>
