<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Live TV Channel</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1a1a1a; /* Dark background */
            color: #f0f0f0; /* Light text */
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            flex-direction: column;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        .tv-container {
            width: 90%; /* Adjust as needed */
            max-width: 1280px; /* Max width for large screens, e.g., 720p or 1080p aspect */
            border-radius: 10px;
            overflow: hidden; /* Crucial for hiding parts of the scrolling text outside the container */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            background-color: #2a2a2a;
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio (height / width * 100) */
            height: 0;
            overflow: hidden;
            background-color: black; /* Background for when video is loading */
        }

        #player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10; /* Place it above the video */
            pointer-events: auto; /* It will receive pointer events */
            /* background: rgba(255, 0, 0, 0.1); /* Uncomment for debugging to see the overlay */
        }

        /* NEW: Thumbnail Placeholder Styling */
        .video-thumbnail-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000; /* Black background behind thumbnail */
            background-size: contain; /* Scales image to fit without cropping */
            /* Or 'cover' if you prefer the image to fill the space, cropping if necessary */
            background-position: center;
            background-repeat: no-repeat;
            z-index: 12; /* Above video, below overlay/unmute button */
            display: none; /* Hidden by default */
            transition: opacity 0.3s ease; /* Smooth fade in/out */
            opacity: 0;
        }


        /* Custom Unmute Button */
        .unmute-button {
            position: absolute;
            top: 20px; /* Distance from the top */
            right: 20px; /* Distance from the right */

            z-index: 20; /* Place it above the overlay and video */
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            padding: 15px; /* Adjust padding as needed */
            border-radius: 50%; /* Make it circular */
            cursor: pointer;
            font-size: 4.5em; /* ICON SIZE SET TO 4.5em */
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease, opacity 0.3s ease;
            opacity: 1; /* Default visible state */
        }

        .unmute-button:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .unmute-button .mute-icon { display: none; }
        .unmute-button.muted .mute-icon { display: inline-block; }
        .unmute-button.muted .unmute-icon { display: none; }
        .unmute-button:not(.muted) .mute-icon { display: none; }
        .unmute-button:not(.muted) .unmute-icon { display: inline-block; }

        /* Scrolling Text Container */
        .scrolling-text-container {
            position: absolute; /* Position relative to .video-container */
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px; /* Height of the ticker */
            background-color: red; /* Red background */
            overflow: hidden; /* Hide text outside this band */
            z-index: 15; /* Above video, below unmute button */
            display: flex;
            align-items: center; /* Vertically center the text */
            white-space: nowrap; /* Prevent text from wrapping */
            box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.3); /* Subtle shadow above ticker */
        }

        .scrolling-text {
            color: white; /* White text */
            font-size: 1.2em; /* Adjust font size */
            font-weight: bold;
            padding-left: 100%; /* Start text off-screen to the right */
            animation: scroll-left 40s linear infinite; /* Animation duration and loop */
        }

        /* Keyframe animation for scrolling */
        @keyframes scroll-left {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-100%); } /* Scrolls its own width left */
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .tv-container {
                width: 95%;
            }

            .unmute-button {
                top: 10px;
                right: 10px;
                padding: 10px;
                font-size: 3.0em; /* Adjusted for smaller screens */
            }

            .scrolling-text-container {
                height: 30px; /* Smaller height on smaller screens */
            }

            .scrolling-text {
                font-size: 1em;
                animation-duration: 30s; /* Faster scroll on smaller screens */
            }
        }

        @media (max-width: 480px) {
            .tv-container {
                width: 100%;
                border-radius: 0;
            }
            .unmute-button {
                top: 5px;
                right: 5px;
                padding: 8px;
                font-size: 2.0em; /* Adjusted for very small screens */
            }

            .scrolling-text-container {
                height: 25px;
            }

            .scrolling-text {
                font-size: 0.9em;
                animation-duration: 25s;
            }
        }
    </style>
</head>
<body>

    <div class="tv-container">
        <div class="video-container">
            <div id="player"></div>
            <div class="video-overlay"></div>
            <div class="video-thumbnail-placeholder" id="videoThumbnail"></div> <button id="unmuteButton" class="unmute-button muted">
                <span class="mute-icon">ðŸ”‡</span>
                <span class="unmute-icon">ðŸ”Š</span>
            </button>

            <div class="scrolling-text-container">
                <div class="scrolling-text" id="newsTicker">
                    Welcome to My Live TV Channel! Tune in 24/7 for great content. Stay tuned for exciting upcoming programs! This is a demo of scrolling text.
                    Â Â Â Â Â Â Â Â Â Â Â Â Â  Breaking News: Live broadcast continues! Â Â Â Â Â Â Â Â Â Â Â Â Â  
                    Remember to unmute for sound! Â Â Â Â Â Â Â Â Â Â Â Â Â  
                    Enjoy the show!
                </div>
            </div>
        </div>
    </div>

    <script>
        // Helper function to parse various YouTube URLs/IDs
        function parseYouTubeLink(link) {
            const videoRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
            const playlistRegex = /(?:youtube\.com\/(?:playlist\?list=|embed\/videoseries\?list=))([a-zA-Z0-9_-]+)/;

            let match;

            match = link.match(playlistRegex);
            if (match && match[1]) return { type: 'playlist', id: match[1] };

            match = link.match(videoRegex);
            if (match && match[1]) return { type: 'video', id: match[1] };

            if (link.length === 11 && /^[a-zA-Z0-9_-]+$/.test(link)) {
                return { type: 'video', id: link };
            }

            console.warn(`Unrecognized YouTube link format: ${link}`);
            return null;
        }

        // --- YOUR 24/7 CONTINUOUS PLAYLIST ---
        // Each video in this list will play for exactly VIDEO_SLOT_DURATION_SECONDS.
        const youtubePlaylist = [
            '17LL_iqlHE8', // Example: Rick Astley
            'xHs7aUUOlJo', // Example: Lofi Hip Hop Radio
            'RQqYw5nJK7A', // Example: Epic Nature Documentary
            'bKZTnnFU9HA', // Example: Cozy Fireplace Sounds
            'cakb1SD-vXM', // Another example video
            'hOi9ozRqZT4',
            // Add more video IDs or full URLs here.
            // NOTE: Playlist URLs (list=...) will *not* work with the fixed 50-second duration.
            // They would play the entire playlist, overriding the 50-second cut-off logic.
            // For 50-second slots, use individual video IDs or URLs only.
        ];

        // --- CONFIGURATION FOR VIDEO SLOTS ---
        const VIDEO_SLOT_DURATION_SECONDS = 180; // Each video will play for 180 seconds

        // Global state variables
        const LAST_PLAYED_KEY = 'lastPlayedVideo';
        let currentVideoIndex = 0;
        let player;
        let saveInterval; // For saving last played position
        let videoTimeout; // To force video change after the slot duration

        const unmuteButton = document.getElementById('unmuteButton');
        const newsTicker = document.getElementById('newsTicker');
        const videoThumbnail = document.getElementById('videoThumbnail'); // NEW: Get thumbnail element

        // Helper function to get YouTube thumbnail URL
        function getThumbnailUrl(videoId) {
            // YouTube provides various thumbnail qualities. 'hqdefault' is high quality.
            // 'maxresdefault' is highest quality but not always available.
            return `https://www.youtube.com/iframe_api`;
        }

        // NEW: Function to display the thumbnail
        function displayThumbnail(videoId) {
            if (!videoId) {
                console.warn("No video ID provided for thumbnail.");
                videoThumbnail.style.opacity = '0';
                videoThumbnail.style.display = 'none';
                return;
            }
            videoThumbnail.style.backgroundImage = `url('${getThumbnailUrl(videoId)}')`;
            videoThumbnail.style.display = 'block';
            // Trigger reflow for transition to work
            videoThumbnail.offsetHeight; 
            videoThumbnail.style.opacity = '1';
        }

        // NEW: Function to hide the thumbnail
        function hideThumbnail() {
            videoThumbnail.style.opacity = '0';
            // Hide only after transition
            setTimeout(() => {
                videoThumbnail.style.display = 'none';
                videoThumbnail.style.backgroundImage = 'none'; // Clear image
            }, 300); // Match CSS transition duration
        }

        // Function to load the current item from the playlist
        function loadPlaylistItem() {
            if (youtubePlaylist.length === 0) {
                console.error("YouTube playlist is empty. Please add video/playlist URLs or IDs.");
                displayThumbnail(null); // Hide any lingering thumbnail
                return;
            }

            if (currentVideoIndex >= youtubePlaylist.length) {
                currentVideoIndex = 0; // Loop back to the beginning
            }

            const itemToPlay = youtubePlaylist[currentVideoIndex];
            const parsedItem = parseYouTubeLink(itemToPlay);

            if (parsedItem && parsedItem.type === 'video') {
                console.log(`Loading video: ${parsedItem.id}`);
                
                // NEW: Display thumbnail of the video about to be loaded
                displayThumbnail(parsedItem.id);

                const lastPlayed = JSON.parse(localStorage.getItem(LAST_PLAYED_KEY));
                let startTime = 0;
                if (lastPlayed && lastPlayed.index === currentVideoIndex) {
                    startTime = lastPlayed.time;
                }
                
                player.loadVideoById(parsedItem.id, startTime);
                
                clearTimeout(videoTimeout);
                videoTimeout = setTimeout(() => {
                    console.log(`${VIDEO_SLOT_DURATION_SECONDS}-second slot ended for ${parsedItem.id}. Moving to next video.`);
                    currentVideoIndex++;
                    loadPlaylistItem();
                }, VIDEO_SLOT_DURATION_SECONDS * 1000);

                player.unMute();
                unmuteButton.classList.remove('muted');

            } else {
                console.error(`Skipping invalid or non-video item in playlist at index ${currentVideoIndex}: ${itemToPlay}. Moving to next.`);
                currentVideoIndex++;
                loadPlaylistItem();
            }
        }

        // This function creates an <iframe> (and YouTube player)
        // after the API code downloads.
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '390',
                width: '640',
                playerVars: {
                    'autoplay': 1,
                    'controls': 0,
                    'disablekb': 1,
                    'autohide': 1,
                    'modestbranding': 1,
                    'rel': 0,
                    'iv_load_policy': 3
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
        }

        // The API will call this function when the video player is ready.
        function onPlayerReady(event) {
            const lastPlayed = JSON.parse(localStorage.getItem(LAST_PLAYED_KEY));
            if (lastPlayed && youtubePlaylist[lastPlayed.index]) {
                currentVideoIndex = lastPlayed.index;
            } else {
                currentVideoIndex = 0;
            }
            
            loadPlaylistItem();

            player.mute();
            unmuteButton.classList.add('muted'); 

            saveInterval = setInterval(() => {
                if (player && player.getCurrentTime) {
                    localStorage.setItem(LAST_PLAYED_KEY, JSON.stringify({
                        index: currentVideoIndex,
                        time: player.getCurrentTime()
                    }));
                }
            }, 5000);
        }

        // The API calls this function when the player's state changes.
        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.ENDED) {
                console.log(`Video naturally ended. Moving to next.`);
                clearTimeout(videoTimeout);
                currentVideoIndex++;
                // Display thumbnail for the *next* video while it loads
                const nextVideoId = youtubePlaylist[currentVideoIndex % youtubePlaylist.length];
                const parsedNext = parseYouTubeLink(nextVideoId);
                displayThumbnail(parsedNext ? parsedNext.id : null);
                loadPlaylistItem();
            }
            else if (event.data === YT.PlayerState.PLAYING) {
                // NEW: Hide thumbnail when video actually starts playing
                hideThumbnail();
                 clearTimeout(videoTimeout);
                 videoTimeout = setTimeout(() => {
                     console.log(`${VIDEO_SLOT_DURATION_SECONDS}-second slot ended (PlayerState.PLAYING) for current video. Moving to next.`);
                     currentVideoIndex++;
                     loadPlaylistItem();
                 }, VIDEO_SLOT_DURATION_SECONDS * 1000 - (player.getCurrentTime() * 1000 || 0));
            } else if (event.data === YT.PlayerState.BUFFERING) {
                // Optionally, display thumbnail during buffering if the video goes black
                const currentVideo = youtubePlaylist[currentVideoIndex];
                const parsedCurrent = parseYouTubeLink(currentVideo);
                displayThumbnail(parsedCurrent ? parsedCurrent.id : null);
            }
        }

        // Handle player errors (e.g., video not found, private video, playback issue)
        function onPlayerError(event) {
            console.error('YouTube Player Error:', event.data, 'Attempting to skip to next item.');
            clearTimeout(videoTimeout);
            currentVideoIndex++;
            // Display thumbnail of the *next* video before attempting to load it
            const nextVideoId = youtubePlaylist[currentVideoIndex % youtubePlaylist.length];
            const parsedNext = parseYouTubeLink(nextVideoId);
            displayThumbnail(parsedNext ? parsedNext.id : null);
            loadPlaylistItem();
        }

        // Unmute button functionality
        unmuteButton.addEventListener('click', () => {
            if (player.isMuted()) {
                player.unMute();
                unmuteButton.classList.remove('muted');
            } else {
                player.mute();
                unmuteButton.classList.add('muted');
            }
        });

        // Load the IFrame Player API asynchronously.
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api"; // THE OFFICIAL YOUTUBE API URL
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // Clear intervals and timeouts when the page is about to be unloaded
        window.addEventListener('beforeunload', () => {
            clearInterval(saveInterval);
            clearTimeout(videoTimeout);
        });
    </script>

</body>
</html>
