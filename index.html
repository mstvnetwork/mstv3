<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MSTV Minimal YouTube Playlist</title>
<style>
  body { background: #000; color: #fff; font-family: Arial, sans-serif; text-align: center; padding: 1rem; }
  h1 { color: gold; margin-bottom: 0; }
  #nowPlaying { margin: 1rem 0; font-weight: bold; font-size: 1.2rem; }
  #playerContainer { width: 320px; height: 180px; margin: 0 auto; position: relative; }
  #ytPlayer iframe { width: 100%; height: 100%; }
  #speakerBtn {
    position: absolute; bottom: 10px; right: 10px; background: gold; border-radius: 50%; width: 36px; height: 36px;
    cursor: pointer; display: flex; align-items: center; justify-content: center; user-select: none;
  }
  #speakerIcon { fill: black; width: 20px; height: 20px; }
  #tvGuideList { list-style: none; padding: 0; max-width: 320px; margin: 1rem auto 0; text-align: left; }
  #tvGuideList li { padding: 8px; border-bottom: 1px solid #555; cursor: default; }
  #tvGuideList li.active { background: gold; color: black; font-weight: bold; }
</style>
<script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>

<h1>MSTV NETWORK</h1>
<div id="nowPlaying">Now Playing: Loading...</div>

<div id="playerContainer">
  <div id="ytPlayer"></div>
  <div id="speakerBtn" title="Toggle mute" aria-label="Toggle mute" role="button" tabindex="0">
    <svg id="speakerIcon" viewBox="0 0 24 24"><path d="M5 9v6h4l5 5V4L9 9H5z"/></svg>
  </div>
</div>

<ul id="tvGuideList"></ul>

<script>
  const sources = [
    { title: "Bollywood Hits 1", url: "https://www.youtube.com/watch?v=NdYQ00MM-IY" },
    { title: "Bollywood Hits 2", url: "https://www.youtube.com/watch?v=_ZXk0hu5BLA" },
    { title: "Live News", url: "https://www.youtube.com/watch?v=1b8bBvoIFHY" }
  ];

  let currentIndex = 0;
  let ytPlayer = null;
  let isMuted = true;

  const nowPlaying = document.getElementById('nowPlaying');
  const tvGuideList = document.getElementById('tvGuideList');
  const speakerBtn = document.getElementById('speakerBtn');

  function updateNowPlaying() {
    nowPlaying.textContent = "Now Playing: " + sources[currentIndex].title;
  }

  function buildGuide() {
    tvGuideList.innerHTML = "";
    sources.forEach((item, i) => {
      const li = document.createElement('li');
      li.textContent = item.title;
      if(i === currentIndex) li.classList.add('active');
      tvGuideList.appendChild(li);
    });
  }

  function getYoutubeVideoId(url) {
    try {
      const urlObj = new URL(url);
      return urlObj.searchParams.get('v');
    } catch {
      return url;
    }
  }

  function playVideoByIndex(index) {
    currentIndex = index % sources.length;
    updateNowPlaying();
    buildGuide();

    const videoId = getYoutubeVideoId(sources[currentIndex].url);
    if(ytPlayer) {
      ytPlayer.loadVideoById(videoId);
      if(isMuted) ytPlayer.mute();
      else ytPlayer.unMute();
      ytPlayer.playVideo();
      return;
    }

    ytPlayer = new YT.Player('ytPlayer', {
      height: '180',
      width: '320',
      videoId: videoId,
      playerVars: {
        autoplay: 1,
        controls: 0,
        modestbranding: 1,
        playsinline: 1,
        disablekb: 1,
        rel: 0,
        showinfo: 0,
        mute: 1
      },
      events: {
        onReady: (e) => {
          if(!isMuted) e.target.unMute();
          e.target.playVideo();
        },
        onStateChange: (e) => {
          if(e.data === YT.PlayerState.ENDED) {
            playVideoByIndex(currentIndex + 1);
          }
        }
      }
    });
  }

  speakerBtn.addEventListener('click', () => {
    isMuted = !isMuted;
    if(ytPlayer) {
      if(isMuted) ytPlayer.mute();
      else ytPlayer.unMute();
    }
    speakerBtn.title = isMuted ? "Unmute" : "Mute";
  });

  // This function is called by YouTube API when itâ€™s ready
  function onYouTubeIframeAPIReady() {
    playVideoByIndex(0);
  }

  window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
</script>

</body>
</html>
