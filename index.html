<!DOCTYPE html>
<html>
<head>
    <title>My Custom YouTube Channel</title>
    <style>
        /* Basic styling for your page and player container */
        body { 
            font-family: sans-serif; 
            text-align: center; 
            margin-top: 50px; 
            background-color: #f0f0f0; 
            color: #333; 
        }
        h1 { 
            color: #333; 
        }
        
        /* Player container styling */
        .player-container {
            position: relative; /* Crucial for positioning the logo overlay */
            width: 640px;      /* Set width */
            height: 390px;     /* Set height */
            margin: 20px auto; /* Center the player */
            background-color: #000; 
            border: 1px solid #ccc; 
            overflow: hidden; /* Important to clip anything outside the container */
        }

        /* YouTube player (iframe) styling */
        #player { 
            position: absolute; /* Takes full size of player-container */
            top: 0;
            left: 0;
            width: 100%; 
            height: 100%; 
        }

        /* Unmute button styling */
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            cursor: pointer; 
            background-color: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            font-size: 1em; 
        }
        button:hover { 
            background-color: #0056b3; 
        }

        /* Video title styling */
        #videoTitle { 
            font-size: 1.5em; 
            margin-bottom: 15px; 
            color: #555; 
        }

        /* Custom logo overlay styling */
        .custom-logo-overlay {
            position: absolute; /* Positioned relative to .player-container */
            bottom: 10px;       /* Adjust as needed: distance from bottom */
            right: 10px;        /* Adjust as needed: distance from right */
            width: 80px;        /* Adjust as needed: size of your logo */
            height: auto;       /* Maintain aspect ratio */
            z-index: 10;        /* Ensure it's above the YouTube player */
            opacity: 0.9;       /* Slightly transparent */
        }
    </style>
</head>
<body>
    <h1>My Custom YouTube Channel</h1>
    <div id="videoTitle"></div> <div class="player-container">
        <div id="player"></div> <img src="/logo.png" alt="My Channel Logo" class="custom-logo-overlay" />
    </div>

    <button id="unmuteButton" onclick="unmuteVideo()">Unmute</button>

    <script>
        // --- STEP 1: REPLACE THIS URL WITH YOUR ACTUAL RENDER SERVER URL ---
        const renderServerUrl = "https://my-youtube-channel-server.onrender.com"; // <-- IMPORTANT: Change this line!
        // -----------------------------------------------------------------

        let player; // This will hold the YouTube player object
        let playlist = []; // This will store the playlist fetched from your Render server
        let currentVideoIndex = -1; // Keeps track of which video is currently playing

        // 1. Load the YouTube IFrame Player API code.
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api"; // Official YouTube API URL
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // 2. This function is called by the YouTube API once it's loaded.
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '390',
                width: '640',
                videoId: '', // Player starts empty, we'll load videos via JavaScript
                playerVars: {
                    'autoplay': 1,      // Attempt to autoplay
                    'controls': 0,      // Hide player controls
                    'mute': 1,          // Mute the video (highly recommended for autoplay to work)
                    'disablekb': 1,     // Disable keyboard controls (like spacebar to play/pause)
                    'fs': 0,            // Hide fullscreen button
                    'iv_load_policy': 3,// Hide annotations and cards
                    'modestbranding': 1, // Remove YouTube logo (some branding may remain)
                    'rel': 0            // Don't show related videos at the end
                },
                events: {
                    'onReady': onPlayerReady,           // When the player is ready
                    'onStateChange': onPlayerStateChange // When video starts, ends, pauses etc.
                }
            });
        }

        // 3. This function runs when the player is ready.
        async function onPlayerReady(event) {
            console.log("YouTube Player is ready!");
            await fetchAndPopulateVideos();

            if (playlist.length > 0) {
                currentVideoIndex = 0; // Start with the first video
                loadAndPlayVideo(playlist[currentVideoIndex].id);
            }
        }

        // 4. This function handles when a video ends (to play the next one automatically).
        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.ENDED) {
                playNext(); // Automatically play next video
            }
        }

        // 5. Fetches the playlist from your Render server
        async function fetchAndPopulateVideos() {
            try {
                const response = await fetch(`${renderServerUrl}/playlist`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                playlist = await response.json();
            } catch (error) {
                console.error("Could not fetch playlist:", error);
                alert("Error loading playlist. Check your Render server URL and ensure it's running.");
            }
        }

        // 6. Loads and plays a specific YouTube video ID
        function loadAndPlayVideo(videoId) {
            if (player && videoId) {
                player.loadVideoById(videoId);
                updateVideoTitle();
            }
        }

        // 7. Updates the title displayed above the player
        function updateVideoTitle() {
            if (currentVideoIndex >= 0 && currentVideoIndex < playlist.length) {
                document.getElementById('videoTitle').textContent = playlist[currentVideoIndex].title;
            } else {
                document.getElementById('videoTitle').textContent = "No video loaded";
            }
        }

        // 8. Function to automatically play the next video in sequence
        function playNext() {
            if (playlist.length === 0) return;
            currentVideoIndex = (currentVideoIndex + 1) % playlist.length; // Loop back to start
            loadAndPlayVideo(playlist[currentVideoIndex].id);
        }

        // 9. New function to unmute the video
        function unmuteVideo() {
            if (player && player.isMuted()) {
                player.unMute();
                // Optional: You can hide the unmute button after it's clicked if you prefer
                // document.getElementById('unmuteButton').style.display = 'none';
            }
        }
    </script>
</body>
</html>
