<!DOCTYPE html>
<html>
<head>
Â  <title>Global Sync YouTube Player</title>
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: sans-serif;
Â  Â  Â  background: #000;
Â  Â  Â  color: white;
Â  Â  Â  margin: 0;
Â  Â  Â  text-align: center;
Â  Â  }
Â  Â  #player-container {
Â  Â  Â  position: relative;
Â  Â  Â  width: 100%;
Â  Â  Â  max-width: 640px;
Â  Â  Â  margin: auto;
Â  Â  Â  padding-top: 56.25%;
Â  Â  }
Â  Â  #player {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 0; left: 0;
Â  Â  Â  width: 100%; height: 100%;
Â  Â  Â  pointer-events: none;
Â  Â  }
Â  Â  #mute-toggle {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 8px; right: 8px;
Â  Â  Â  font-size: 24px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  z-index: 10;
Â  Â  Â  background: rgba(0,0,0,0.6);
Â  Â  Â  border-radius: 50%;
Â  Â  Â  padding: 6px;
Â  Â  Â  user-select: none;
Â  Â  }
Â  Â  #scrolling-banner {
Â  Â  Â  position: absolute;
Â  Â  Â  bottom: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  background-color: #007BFF;
Â  Â  Â  color: white;
Â  Â  Â  font-size: clamp(14px, 3vw, 20px);
Â  Â  Â  font-weight: bold;
Â  Â  Â  font-family: monospace;
Â  Â  Â  overflow: hidden;
Â  Â  Â  user-select: none;
Â  Â  Â  z-index: 10;
Â  Â  Â  pointer-events: none;
Â  Â  Â  padding: 8px 0;
Â  Â  }
Â  Â  #marquee-text {
Â  Â  Â  display: inline-block;
Â  Â  Â  white-space: nowrap;
Â  Â  Â  padding-left: 100%;
Â  Â  Â  animation: marquee 15s linear infinite;
Â  Â  }
Â  Â  @keyframes marquee {
Â  Â  Â  0% { transform: translateX(0%); }
Â  Â  Â  100% { transform: translateX(-100%); }
Â  Â  }
Â  Â  #loading-overlay {
Â  Â  Â  position: fixed;
Â  Â  Â  inset: 0;
Â  Â  Â  background-color: #000;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  Â  z-index: 9999;
Â  Â  }
Â  Â  #loading-spinner {
Â  Â  Â  width: 60px;
Â  Â  Â  height: 60px;
Â  Â  Â  border: 3px solid rgba(255, 215, 0, 0.2);
Â  Â  Â  border-top: 3px solid #FFD700;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  animation: spin 0.8s linear infinite;
Â  Â  Â  margin-bottom: 16px;
Â  Â  Â  box-shadow: 0 0 10px #FFD70088;
Â  Â  }
Â  Â  @keyframes spin {
Â  Â  Â  to { transform: rotate(360deg); }
Â  Â  }
Â  Â  #loading-text {
Â  Â  Â  color: #FFD700;
Â  Â  Â  font-size: 20px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  font-family: "Courier New", monospace;
Â  Â  Â  text-shadow: 0 0 6px #FFD70099;
Â  Â  Â  letter-spacing: 1px;
Â  Â  }
Â  </style>
</head>
<body>
Â  <div id="player-container">
Â  Â  <div id="player"></div>
Â  Â  <div id="mute-toggle">ðŸ”‡</div>
Â  Â  <div id="scrolling-banner">
Â  Â  Â  <div id="marquee-text">Loading...</div>
Â  Â  </div>
Â  </div>

Â  <div id="loading-overlay">
Â  Â  <div id="loading-spinner"></div>
Â  Â  <div id="loading-text">Stream Loading...</div>
Â  </div>

<script>
Â  const urlParams = new URLSearchParams(window.location.search);
Â  const ch = urlParams.get('ch') || '1';
Â  const jsonUrl = `https://raw.githubusercontent.com/mstvnetwork/mstv3/main/sync-ch${ch}.json`;

Â  let player;
Â  let playlist = [];
Â  let startTimeUTC = null;
Â  let currentVideoIndex = 0;
Â  let startSeconds = 0;
Â  let isMuted = true;

Â  function updateBanner() {
Â  Â  const marquee = document.getElementById('marquee-text');
Â  Â  if (playlist.length === 0) {
Â  Â  Â  marquee.textContent = 'No videos in playlist';
Â  Â  } else {
Â  Â  Â  marquee.textContent = `Now Playing: ${playlist[currentVideoIndex].title}`;
Â  Â  }
Â  }

Â  async function syncAndPlay() {
Â  Â  if (!startTimeUTC || playlist.length === 0) return;

Â  Â  const now = Date.now();
Â  Â  const elapsedSeconds = Math.floor((now - startTimeUTC) / 1000);
Â  Â  const totalDuration = playlist.reduce((sum, video) => sum + video.duration_seconds, 0);
Â  Â  const loopedElapsed = elapsedSeconds % totalDuration;

Â  Â  let accumulated = 0;
Â  Â  for (let i = 0; i < playlist.length; i++) {
Â  Â  Â  if (loopedElapsed < accumulated + playlist[i].duration_seconds) {
Â  Â  Â  Â  currentVideoIndex = i;
Â  Â  Â  Â  startSeconds = loopedElapsed - accumulated;
Â  Â  Â  Â  break;
Â  Â  Â  }
Â  Â  Â  accumulated += playlist[i].duration_seconds;
Â  Â  }
Â  Â  if (startSeconds < 0) startSeconds = 0;

Â  Â  const video = playlist[currentVideoIndex];
Â  Â  updateBanner();

Â  Â  if (!player) {
Â  Â  Â  player = new YT.Player('player', {
Â  Â  Â  Â  height: '360',
Â  Â  Â  Â  width: '640',
Â  Â  Â  Â  videoId: video.id,
Â  Â  Â  Â  playerVars: {
Â  Â  Â  Â  Â  autoplay: 1,
Â  Â  Â  Â  Â  controls: 0,
Â  Â  Â  Â  Â  modestbranding: 1,
Â  Â  Â  Â  Â  rel: 0,
Â  Â  Â  Â  Â  fs: 0,
Â  Â  Â  Â  Â  start: startSeconds,
Â  Â  Â  Â  Â  mute: 1
Â  Â  Â  Â  },
Â  Â  Â  Â  events: {
Â  Â  Â  Â  Â  onReady: (event) => {
Â  Â  Â  Â  Â  Â  isMuted ? event.target.mute() : event.target.unMute();
Â  Â  Â  Â  Â  Â  event.target.playVideo();
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  onStateChange: (event) => {
Â  Â  Â  Â  Â  Â  if (event.data === YT.PlayerState.PLAYING) {
Â  Â  Â  Â  Â  Â  Â  document.getElementById('loading-overlay').style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (event.data === YT.PlayerState.ENDED) {
Â  Â  Â  Â  Â  Â  Â  currentVideoIndex = (currentVideoIndex + 1) % playlist.length;
Â  Â  Â  Â  Â  Â  Â  startSeconds = 0;
Â  Â  Â  Â  Â  Â  Â  const nextVideo = playlist[currentVideoIndex];
Â  Â  Â  Â  Â  Â  Â  player.loadVideoById({ videoId: nextVideo.id, startSeconds });
Â  Â  Â  Â  Â  Â  Â  updateBanner();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  } else {
Â  Â  Â  player.loadVideoById({ videoId: video.id, startSeconds });
Â  Â  Â  updateBanner();
Â  Â  }
Â  }

Â  async function fetchPlaylist() {
Â  Â  try {
Â  Â  Â  const res = await fetch(jsonUrl);
Â  Â  Â  const data = await res.json();
Â  Â  Â  playlist = data.video_list || [];
Â  Â  Â  startTimeUTC = new Date(data.start_time_utc).getTime();
Â  Â  Â  loadYouTubeAPI();
Â  Â  } catch (e) {
Â  Â  Â  console.error('Error fetching JSON:', e);
Â  Â  }
Â  }

Â  const muteToggle = document.getElementById('mute-toggle');
Â  const muteKey = 'ytPlayerMuted';

Â  if (sessionStorage.getItem(muteKey) === 'false') {
Â  Â  isMuted = false;
Â  Â  muteToggle.textContent = 'ðŸ”Š';
Â  } else {
Â  Â  isMuted = true;
Â  Â  muteToggle.textContent = 'ðŸ”‡';
Â  }

Â  muteToggle.addEventListener('click', () => {
Â  Â  if (!player) return;
Â  Â  if (isMuted) {
Â  Â  Â  player.unMute();
Â  Â  Â  isMuted = false;
Â  Â  Â  muteToggle.textContent = 'ðŸ”Š';
Â  Â  Â  sessionStorage.setItem(muteKey, 'false');
Â  Â  } else {
Â  Â  Â  player.mute();
Â  Â  Â  isMuted = true;
Â  Â  Â  muteToggle.textContent = 'ðŸ”‡';
Â  Â  Â  sessionStorage.setItem(muteKey, 'true');
Â  Â  }
Â  });

Â  function loadYouTubeAPI() {
Â  Â  const tag = document.createElement('script');
Â  Â  tag.src = "https://www.youtube.com/iframe_api";
Â  Â  document.head.appendChild(tag);
Â  }

Â  window.onYouTubeIframeAPIReady = () => {
Â  Â  syncAndPlay();
Â  Â  setInterval(syncAndPlay, 5000);
Â  };

Â  fetchPlaylist();
</script>
</body>
</html>
