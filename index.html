<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="MSTV Network offers a variety of live TV channels including music, movies, and more. Watch your favorite channels online for free.">
    <meta name="keywords" content="live TV, MSTV Network, free TV, live channels, streaming, music, bollywood, saga music">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="MSTV Network">
    <meta property="og:description" content="Stream live TV channels including music, movies, and more on MSTV Network.">
    <meta property="og:image" content="https://raw.githubusercontent.com/mstvnetwork/mstv2/refs/heads/main/Design-Studio-2025-01-20%20(2).png">
    <meta property="og:url" content="https://mstvnet.netlify.app/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="MSTV Network">
    <meta name="twitter:description" content="Stream live TV channels including music, movies, and more on MSTV Network.">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/mstvnetwork/mstv2/refs/heads/main/Design-Studio-2025-01-20%20(2).png">
    <meta name="twitter:url" content="https://mstvnet.netlify.app/">

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "MSTV Network",
        "description": "Stream live TV channels including music, movies and more.",
        "url": "https://yourwebsite.com",
        "publisher": {
            "@type": "Organization",
            "name": "MSTV Network",
            "logo": {
                "@type": "ImageObject",
                "url": "https://raw.githubusercontent.com/mstvnetwork/mstv2/refs/heads/main/Design-Studio-2025-01-20%20(2).png"
            }
        }
    }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <title>MSTV INDIA</title>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        html {
            font-size: 16px;
            background: linear-gradient(145deg, #1A0D3C, #3F0057);
            min-height: 100%;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
            width: 100%;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .title-3d {
            font-size: 3em;
            text-align: center;
            margin-top: 30px;
            color: #00ffe7;
            text-shadow: 0 0 10px #00ffe7, 0 0 20px #0ff, 0 0 30px #0ff;
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            0% { text-shadow: 0 0 10px #00ffe7, 0 0 20px #0ff; }
            100% { text-shadow: 0 0 20px #00ffe7, 0 0 30px #0ff; }
        }

        .scrolling-text {
            overflow: hidden;
            white-space: nowrap;
            padding: 12px 0;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.05);
            border-top: 2px solid #00ffe7;
            border-bottom: 2px solid #00ffe7;
        }

        .scrolling-content {
            display: inline-block;
            padding-left: 100%;
            animation: scroll-text 15s linear infinite;
            font-size: 1.3em;
            color: #00ffe7;
        }

        @keyframes scroll-text {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-100%); }
        }

        * {
            box-sizing: border-box;
        }

        .channel-selector-text {
            text-align: center;
            font-size: 1.6em;
            margin: 2vh 0 1vh;
            color: #ff4fd8;
            padding: 0 5vw;
        }

        /* CSS Adjustment for better centering on desktop */
        .channel-selection {
            /* Removed text-align as flexbox will handle centering */
            margin-bottom: 3vh;
            padding: 0 5vw;
            display: flex; /* Make it a flex container */
            justify-content: center; /* Center items horizontally */
            align-items: center; /* Center items vertically (if height allows) */
        }

        select {
            padding: 0.5em 1em;
            font-size: 1.1em;
            background: #111;
            color: #0ff;
            border: 2px solid #0ff;
            border-radius: 15px;
            outline: none;
            transition: 0.3s;
            text-align: center;
            box-shadow: 0 0 10px #0ff;
            width: 100%;
            max-width: 400px;
            /* margin: 0 auto; - Can keep this, but flexbox on parent makes it less critical */
            display: block;
        }

        select:hover {
            background: #1f0037;
            color: #fff;
            box-shadow: 0 0 15px #ff4fd8;
        }

        .player-container {
            position: relative;
            width: 90%;
            max-width: 1000px;
            aspect-ratio: 16 / 9;
            margin: 0 auto 40px;
            border: 4px solid;
            border-radius: 20px;
            overflow: hidden;
            background: #000;
            animation: borderPulseUnique 4s ease-in-out infinite;
        }

        @keyframes borderPulseUnique {
            0% { border-color: #ff4fd8; box-shadow: 0 0 15px #ff4fd8; }
            25% { border-color: #00ffe7; box-shadow: 0 0 30px #00ffe7; }
            50% { border-color: #ff4fd8; box-shadow: 0 0 15px #ff4fd8; }
            75% { border-color: #f7ff00; box-shadow: 0 0 30px #f7ff00; }
            100% { border-color: #ff4fd8; box-shadow: 0 0 15px #ff4fd8; }
        }

        .player-container iframe,
        .player-container video,
        #placeholder-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .unmute-button {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00ffe7;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 101;
            font-size: 1.8em;
            color: #fff;
            box-shadow: 0 0 10px rgba(0, 255, 231, 0.5);
            transition: background 0.3s ease, border-color 0.3s ease;
        }

        .unmute-button:hover {
            background: rgba(0, 0, 0, 0.9);
            border-color: #ff4fd8;
            box-shadow: 0 0 15px rgba(255, 79, 216, 0.7);
        }

        .live-stamp {
            position: absolute;
            top: 5px;
            left: 5px;
            background: #ff003c;
            color: white;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 0.9em;
            border-radius: 5px;
            z-index: 10;
            box-shadow: 0 0 10px #ff003c;
        }

        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            background: rgba(0, 0, 0, 0.85);
            color: #ffcc00;
            padding: 15px 30px;
            border-radius: 12px;
            display: none;
            z-index: 15;
            text-align: center;
            animation: glowLoader 1.5s infinite alternate;
        }

        @keyframes glowLoader {
            0% { box-shadow: 0 0 5px #ffcc00; }
            100% { box-shadow: 0 0 15px #ffcc00; }
        }

        .logo-overlay {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 60px;
            height: auto;
            opacity: 0.85;
            z-index: 12;
        }

        /* NEW: Styling for partner logos */
        .partner-logos {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 30px; /* Space between logos */
            margin: 40px auto; /* Margin top/bottom and center horizontally */
            padding: 0 20px; /* Padding on sides */
            max-width: 1000px; /* Max width for the container */
        }

        .partner-logos img {
            max-width: 180px; /* Max width for individual logos */
            height: auto; /* Maintain aspect ratio */
            opacity: 0.8; /* Slightly transparent by default */
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out, box-shadow 0.3s ease-in-out; /* Smooth transitions */
            border-radius: 8px; /* Slightly rounded corners */
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.1); /* Subtle initial shadow */
        }

        .partner-logos img:hover {
            transform: scale(1.08); /* Slightly enlarge on hover */
            opacity: 1; /* Fully opaque on hover */
            box-shadow: 0 0 15px #00ffe7, /* Cyan glow on hover */
                        0 0 25px rgba(0, 255, 231, 0.4);
        }

        audio {
            display: none;
        }

        footer {
            padding: 40px 20px;
            color: #aaa;
            font-family: 'Poppins', sans-serif;
        }

        .footer-section {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: flex-start;
            max-width: 1200px;
            margin: 0 auto;
            gap: 20px;
            padding: 0 15px;
        }

        .footer-column {
            flex: 1 1 auto;
            min-width: 280px;
            margin: 0;
            padding: 10px;
        }

        .footer-column h2 {
            color: #ff004f;
            margin-bottom: 10px;
            font-size: 1.75rem;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .footer-column h3, .footer-column h4 {
            color: #ff004f;
            margin-top: 15px;
            margin-bottom: 5px;
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: 0.03em;
        }

        .footer-column p {
            font-size: 0.9rem;
            line-height: 1.7;
            color: #e0e0e0;
            letter-spacing: 0.02em;
            text-align: justify;
            margin-bottom: 1.5em;
        }

        .footer-column a {
            color: #ffcc00;
            text-decoration: none;
            font-weight: 400;
            transition: color 0.3s ease;
        }

        .footer-column a:hover {
            text-decoration: underline;
            color: #fff;
        }

        .facebook-follow {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .facebook-follow a {
            display: inline-flex;
            align-items: center;
            color: #fff;
            font-size: 1.2em;
            text-decoration: none;
            background: #3b5998;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        .facebook-follow a:hover {
            background: #2d4373;
        }

        .facebook-follow img {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            /* NEW: Filter to change the icon itself to a vibrant red */
            /* This combination transforms the original blue of the Facebook logo to red */
            filter: hue-rotate(300deg) saturate(500%) brightness(120%) contrast(100%);
            
            /* Keep the red glowing box-shadow for pop */
            box-shadow: 0 0 10px #ff0000, /* Primary red glow */
                        0 0 20px rgba(255, 0, 0, 0.4); /* Fainter, larger red glow */
            
            /* Smooth transition for both filter and box-shadow */
            transition: filter 0.3s ease-in-out, box-shadow 0.3s ease-in-out; 
        }

        .facebook-follow a:hover img {
            /* Adjust glow on hover to a slightly different red/orange for interaction */
            box-shadow: 0 0 15px #ff4500, /* Brighter orange-red glow on hover */
                        0 0 25px rgba(255, 69, 0, 0.6);
            
            /* Optional: Slightly adjust filter on hover for a subtle icon color change */
            filter: hue-rotate(305deg) saturate(600%) brightness(130%) contrast(100%); /* Slightly warmer red on hover */
        }

        .copyright {
            text-align: center;
            color: #b0b0b0;
            margin-top: 20px;
            font-size: 0.8rem;
            letter-spacing: 0.03em;
        }

        /* Styles for new status and raw data displays */
        .status-display-container {
            margin: 20px auto;
            max-width: 800px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(0, 255, 231, 0.2);
            text-align: center;
            border: 1px solid rgba(0, 255, 231, 0.5);
        }

        #statusMessage {
            font-size: 1.1em;
            color: #00ffe7;
            margin-bottom: 10px;
        }

        #rawDataDisplay {
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            overflow-x: auto;
            text-align: left;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            color: #d0d0d0;
            border: 1px solid rgba(255, 79, 216, 0.5);
            max-height: 200px; /* Limit height for raw data */
        }


        @media (max-width: 768px) {
            .footer-section {
                flex-direction: column;
                align-items: center;
                gap: 30px;
            }

            .footer-column {
                min-width: unset;
                width: 90%;
                text-align: left;
            }
        }

        @media (max-width: 480px) {
            .footer-column {
                padding: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="title-3d">MSTV INDIA</div>

    <div class="scrolling-text">
        <div class="scrolling-content">Welcome to MSTV India - Refresh the webpage to auto-tune channels!</div>
    </div>

    <div class="status-display-container">
        <div id="statusMessage" class="text-gray-500 rounded-md">Checking for updates...</div>
        <pre id="rawDataDisplay" class="text-sm text-gray-900 rounded-md"></pre>
    </div>
    <div class="channel-selector-text">Select Channel</div>
    <div class="channel-selection">
        <select id="channel-select">
            <option value="">ðŸ‘‰ðŸ“ºðŸ“ºðŸ“º</option>
            </select>
    </div>

    <div class="player-container" id="player-container">
        <iframe id="media-player" allow="autoplay; encrypted-media; picture-in-picture" sandbox="allow-scripts allow-same-origin allow-presentation"></iframe>
        <video id="video-player" autoplay muted playsinline controlsList="nodownload nofullscreen noremote playback" disablePictureInPicture></video>
        <img id="placeholder-image" src="Design-Studio-2025-01-22 (1).png" alt="Stream Placeholder" />
        
        <div class="live-stamp">MSTV NETWORK</div>
        <div class="loading-indicator" id="loading">Loading stream...</div>
        <img src="/logo.png" class="logo-overlay" alt="MSTV Logo" />

        <div class="unmute-button" id="unmute-button">
            <span id="speaker-icon">ðŸ”‡</span>
        </div>
    </div>

    <div class="partner-logos"> <img src="logo.img/images.png" alt="Partner Logo 1">
        <img src="logo.img/images (1).jpeg" alt="Partner Logo 2">
    </div>

    <div class="facebook-follow">
        <a href="https://www.facebook.com/share/16VZyWirq4/" target="_blank">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="Facebook Icon" />
            Follow us on Facebook
        </a>
    </div>

    <footer>
        <div class="footer-section">
            <div class="footer-column">
                <h2>About MSTV</h2>
                <p>MSTV Network is a non-profit platform offering free access to live TV channels, including entertainment, music, news, and more. We provide high-quality streaming to viewers worldwide, ensuring a diverse and engaging experience. Our mission is to make content from the Indian subcontinent accessible to everyone, fostering cultural exchange through free, reliable, and uninterrupted TV streaming.</p>

                <h3>Disclaimer</h3>
                <p>
                    MSTV Network provides access to publicly available channels from various sources on the internet for informational and entertainment purposes only. We do not control or guarantee the accuracy, availability, or legality of the content streamed. All content is provided "as is," and MSTV Network is not liable for any errors, interruptions, or damages arising from the use of our services. By using MSTV Network, you agree to comply with all applicable laws. For more details, please refer to our Terms of Service and Privacy Policy.
                </p>
                <h4>Terms of services</h4>
                <p>By using MSTV Network, you agree to comply with our terms of service...</p>
            </div>
            <div class="footer-column">
                <h2>Contact</h2>
                <p>Email: contact@mstvindia.com</p>
                <p>Phone: +001-305-242-4447 </p>
            </div>
        </div>

        <div class="copyright">Â© 2025 MSTV INDIA. All rights reserved.</div>
    </footer>

    <script>
        const select = document.getElementById('channel-select');
        const videoPlayer = document.getElementById('video-player');
        const iframePlayer = document.getElementById('media-player');
        const placeholder = document.getElementById('placeholder-image');
        const loading = document.getElementById('loading');
        const unmuteButton = document.getElementById('unmute-button');
        const speakerIcon = document.getElementById('speaker-icon');

        // Elements for live updates
        const statusMessage = document.getElementById('statusMessage');
        const rawDataDisplay = document.getElementById('rawDataDisplay');

        let hlsInstance = null;
        let youtubePlayer = null; // Declare youtubePlayer here
        let channelsData = []; // Store fetched channels data
        let lastKnownJsonContent = null; // Stores the last fetched JSON string for comparison

        // --- Configuration for Live Updates ---
        // IMPORTANT: If 'channels.json' is in your GitHub repo root, this path is correct.
        // If it's in a subfolder, e.g., 'data/channels.json', adjust this path.
        // For a full raw GitHub URL (if hosted elsewhere):
        // 'https://raw.githubusercontent.com/your-username/your-repo/main/channels.json'
        const githubJsonUrl = 'channels.json'; // Assuming channels.json is in the same directory
        const pollingInterval = 5000; // Check for updates every 5 seconds (5000 milliseconds)

        function showLoading(show) {
            loading.style.display = show ? 'block' : 'none';
        }

        // --- Mute Button Logic (Unified for HLS/Video and YouTube) ---
        function updateSpeakerIcon() {
            let isCurrentlyMuted = true; // Assume muted by default

            if (videoPlayer.style.display === 'block') {
                isCurrentlyMuted = videoPlayer.muted;
            } else if (iframePlayer.style.display === 'block' && youtubePlayer) {
                // Check if YouTube player is ready and get its mute status
                try {
                    isCurrentlyMuted = youtubePlayer.isMuted();
                } catch (e) {
                    // Player might not be ready yet or error, assume muted
                    console.warn("Could not get YouTube player mute status, assuming muted.", e);
                    isCurrentlyMuted = true;
                }
            } else {
                // No active player, or iframe type not controlled by YouTube API
                unmuteButton.style.display = 'none';
                return; // Exit early if no relevant player
            }

            if (isCurrentlyMuted) {
                speakerIcon.textContent = 'ðŸ”‡';
                unmuteButton.style.display = 'flex'; // Show the button when muted
            } else {
                speakerIcon.textContent = 'ðŸ”Š';
                unmuteButton.style.display = 'flex'; // Keep button visible to re-mute
            }
        }


        unmuteButton.addEventListener('click', () => {
            if (videoPlayer.style.display === 'block') { // HLS/Native video
                videoPlayer.muted = !videoPlayer.muted;
                if (hlsInstance) {
                    hlsInstance.muted = videoPlayer.muted; // Keep HLS.js instance in sync
                }
                updateSpeakerIcon();
            } else if (iframePlayer.style.display === 'block' && youtubePlayer) { // YouTube iframe
                if (youtubePlayer.isMuted()) {
                    youtubePlayer.unMute();
                } else {
                    youtubePlayer.mute();
                }
                updateSpeakerIcon(); // Update icon based on new YouTube state
            }
        });

        // Listen for volume changes on the video player (e.g., if user mutes via native controls)
        videoPlayer.addEventListener('volumechange', updateSpeakerIcon);

        function playChannel(channel) {
            showLoading(true);

            // Stop any currently playing video/iframe
            videoPlayer.pause();
            if (hlsInstance) {
                hlsInstance.destroy();
                hlsInstance = null;
            }
            videoPlayer.removeAttribute('src');
            videoPlayer.load();

            // Destroy YouTube player if it exists
            if (youtubePlayer) {
                try {
                    youtubePlayer.destroy();
                } catch (e) {
                    console.warn("Error destroying previous YouTube player:", e);
                }
                youtubePlayer = null; // Clear reference
            }
            iframePlayer.src = ''; // Clear iframe src

            // Hide all players by default
            videoPlayer.style.display = 'none';
            iframePlayer.style.display = 'none';
            placeholder.style.display = 'none';
            unmuteButton.style.display = 'none'; // Hide mute button initially

            if (channel.type === 'hls') {
                if (Hls.isSupported()) {
                    videoPlayer.style.display = 'block';
                    hlsInstance = new Hls();
                    hlsInstance.loadSource(channel.url);
                    hlsInstance.attachMedia(videoPlayer);
                    hlsInstance.on(Hls.Events.MANIFEST_PARSED, function() {
                        videoPlayer.muted = true; // Start muted
                        videoPlayer.autoplay = true;
                        videoPlayer.play().then(() => {
                            showLoading(false);
                            updateSpeakerIcon(); // Show unmute button since it's muted
                        }).catch(e => {
                            console.error("Video playback failed (HLS):", e);
                            showLoading(false);
                            placeholder.style.display = 'block';
                            unmuteButton.style.display = 'none';
                        });
                    });
                    hlsInstance.on(Hls.Events.ERROR, function (event, data) {
                        console.error('HLS.js error:', data);
                        if (data.fatal) {
                            switch(data.type) {
                                case Hls.ErrorTypes.NETWORK_ERROR:
                                    console.error('Fatal network error encountered, try to recover');
                                    hlsInstance.startLoad();
                                    break;
                                case Hls.ErrorTypes.MEDIA_ERROR:
                                    console.error('Fatal media error encountered, try to recover');
                                    hlsInstance.recoverMediaError();
                                    break;
                                default:
                                    hlsInstance.destroy();
                                    showLoading(false);
                                    placeholder.style.display = 'block';
                                    unmuteButton.style.display = 'none';
                                    break;
                            }
                        }
                    });

                } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                    // Native HLS support (Safari/iOS)
                    videoPlayer.style.display = 'block';
                    videoPlayer.src = channel.url;
                    videoPlayer.muted = true; // Start muted
                    videoPlayer.autoplay = true;
                    videoPlayer.play().then(() => {
                        showLoading(false);
                        updateSpeakerIcon(); // Show unmute button since it's muted
                    }).catch(e => {
                        console.error("Video playback failed (Native HLS):", e);
                        showLoading(false);
                        placeholder.style.display = 'block';
                        unmuteButton.style.display = 'none';
                    });
                } else {
                    showLoading(false);
                    placeholder.style.display = 'block';
                }
            } else if (channel.type === 'youtube') { // Changed type to 'youtube'
                iframePlayer.style.display = 'block';
                // Extract video ID from URL
                const videoIdMatch = channel.url.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|v\/|embed\/|live\/))([a-zA-Z0-9_-]{11})/);
                if (!videoIdMatch) {
                    console.error("Invalid YouTube URL:", channel.url);
                    showLoading(false);
                    placeholder.style.display = 'block';
                    return;
                }
                const videoId = videoIdMatch[1];
                
                // Load YouTube API if not already loaded (this will call onYouTubeIframeAPIReady)
                if (typeof YT === 'undefined' || !YT.Player) {
                    loadYouTubeAPI();
                }

                // Create the YouTube player
                youtubePlayer = new YT.Player('media-player', { // Use the iframePlayer ID
                    videoId: videoId,
                    playerVars: {
                        autoplay: 1, // Autoplay
                        controls: 0, // No controls
                        modestbranding: 1, // Hide YouTube logo
                        rel: 0, // No related videos
                        showinfo: 0, // No video info
                        enablejsapi: 1, // Enable JS API
                        origin: window.location.origin, // Crucial for API calls
                        // mute: 1 // Start muted for reliable autoplay. We'll unmute via button.
                        // If you want to FORCE unmuted autoplay (which might be blocked by browsers), remove 'mute: 1'
                        // and ensure user has clicked something before calling playChannel
                        // For this demo, we'll try to autoplay UNMUTED as per your request,
                        // but be aware of browser restrictions. If it doesn't work, add mute: 1 back.
                    },
                    events: {
                        'onReady': onYouTubePlayerReady,
                        'onStateChange': onYouTubePlayerStateChange,
                        'onError': onYouTubePlayerError
                    }
                });

                showLoading(false);
                // The mute button display will be handled by onYouTubePlayerReady and updateSpeakerIcon
            } else {
                // Fallback for direct video (non-HLS, non-iframe, if any)
                videoPlayer.style.display = 'block';
                videoPlayer.src = channel.url;
                videoPlayer.muted = true; // Start muted
                videoPlayer.autoplay = true;
                videoPlayer.play().then(() => {
                    showLoading(false);
                    updateSpeakerIcon(); // Show unmute button since it's muted
                }).catch((error) => {
                    console.error("Video playback failed (direct video):", error);
                    showLoading(false);
                    placeholder.style.display = 'block';
                    unmuteButton.style.display = 'none';
                });
            }
        }

        // YouTube API related functions
        function onYouTubePlayerReady(event) {
            console.log("YouTube Player is ready!");
            // Attempt to autoplay unmuted. This might be blocked by browser.
            // If it gets blocked, it means you'll hear no sound until user interacts.
            event.target.playVideo();
            updateSpeakerIcon(); // Update button state
        }

        function onYouTubePlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                showLoading(false);
                // Ensure mute button is shown if player is playing (and we don't know its state yet)
                updateSpeakerIcon();
            } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.BUFFERING) {
                // Handle paused/buffering states if needed
            } else if (event.data === YT.PlayerState.ENDED) {
                // Logic for when YouTube video ends, e.g., play next channel
            }
        }

        function onYouTubePlayerError(event) {
            console.error("YouTube Player Error:", event.data);
            showLoading(false);
            placeholder.style.display = 'block';
            unmuteButton.style.display = 'none';
            // You might want to try playing the next channel or show an error message
        }

        // Load YouTube Iframe API script
        function loadYouTubeAPI() {
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api"; // Official YouTube API URL
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }
        window.onYouTubeIframeAPIReady = loadYouTubeAPI; // Call loadYouTubeAPI when this function is declared/available

        /**
         * Populates the channel dropdown with data.
         * @param {Array} data - The array of channel objects.
         */
        function updateChannelDropdown(data) {
            const currentSelectedValue = select.value;
            select.innerHTML = '<option value="">ðŸ‘‰ðŸ“ºðŸ“ºðŸ“º</option>';

            data.forEach((channel, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = channel.name;
                select.appendChild(option);
            });
            console.log('Channel dropdown updated.');

            if (currentSelectedValue !== "") {
                const reselectIndex = parseInt(currentSelectedValue, 10);
                if (!isNaN(reselectIndex) && reselectIndex < data.length) {
                    select.value = reselectIndex;
                    // Automatically play the re-selected channel
                    const selectedChannel = channelsData[reselectIndex];
                    if (selectedChannel) {
                        playChannel(selectedChannel);
                    }
                } else {
                    select.value = "";
                }
            } else if (data.length > 0) {
                // If no channel was selected, automatically select and play the first one
                select.value = 0;
                playChannel(channelsData[0]);
            }
        }

        /**
         * Fetches the channels.json data, checks for updates, and populates the dropdown.
         */
        async function checkAndPopulateChannels() {
            try {
                const urlWithCacheBuster = `${githubJsonUrl}?cacheBuster=${new Date().getTime()}`;
                statusMessage.textContent = 'Fetching latest channels data...';

                const response = await fetch(urlWithCacheBuster);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                const currentJsonString = JSON.stringify(data);

                if (lastKnownJsonContent === null || currentJsonString !== lastKnownJsonContent) {
                    console.log('channels.json data changed! Updating webpage...');
                    channelsData = data;
                    updateChannelDropdown(channelsData);
                    rawDataDisplay.textContent = currentJsonString;
                    statusMessage.textContent = `Channels updated at ${new Date().toLocaleTimeString()}`;
                    lastKnownJsonContent = currentJsonString;
                } else {
                    console.log('No new changes detected in channels.json.');
                    statusMessage.textContent = `No new updates. Last checked at ${new Date().toLocaleTimeString()}`;
                }

            } catch (error) {
                console.error('Failed to fetch or process channels data:', error);
                statusMessage.textContent = `Error loading channels: ${error.message}.`;
            }
        }

        // Event listener for channel selection
        select.addEventListener('change', () => {
            const selectedIndex = select.value;
            if (selectedIndex === "") {
                videoPlayer.pause();
                if (hlsInstance) {
                    hlsInstance.destroy();
                    hlsInstance = null;
                }
                if (youtubePlayer) {
                    try { youtubePlayer.destroy(); } catch (e) { /* ignore */ }
                    youtubePlayer = null;
                }
                videoPlayer.removeAttribute('src');
                iframePlayer.src = '';
                videoPlayer.style.display = 'none';
                iframePlayer.style.display = 'none';
                placeholder.style.display = 'block';
                unmuteButton.style.display = 'none';
                showLoading(false);
                return;
            }
            const selectedChannel = channelsData[selectedIndex];
            if (selectedChannel) {
                playChannel(selectedChannel);
            }
        });
        
        // Initial load and polling
        checkAndPopulateChannels(); // Initial call
        setInterval(checkAndPopulateChannels, pollingInterval); // Poll for updates
    </script>
</body>
</html>
