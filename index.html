<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Live TV Channel</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1a1a1a; /* Dark background */
            color: #f0f0f0; /* Light text */
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            flex-direction: column;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        .tv-container {
            width: 90%; /* Adjust as needed */
            max-width: 1280px; /* Max width for large screens, e.g., 720p or 1080p aspect */
            border-radius: 10px;
            overflow: hidden; /* Crucial for hiding parts of the scrolling text outside the container */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            background-color: #2a2a2a;
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio (height / width * 100) */
            height: 0;
            overflow: hidden;
            background-color: black; /* Background for when video is loading */
        }

        #player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10; /* Place it above the video */
            pointer-events: auto; /* It will receive pointer events */
            /* background: rgba(255, 0, 0, 0.1); /* Uncomment for debugging to see the overlay */
        }

        /* Custom Unmute Button */
        .unmute-button {
            position: absolute;
            top: 20px; /* Distance from the top */
            right: 20px; /* Distance from the right */

            z-index: 20; /* Place it above the overlay and video */
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            padding: 15px; /* Adjust padding as needed */
            border-radius: 50%; /* Make it circular */
            cursor: pointer;
            font-size: 4.5em; /* ICON SIZE SET TO 4.5em */
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease, opacity 0.3s ease;
            opacity: 1; /* Default visible state */
        }

        .unmute-button:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .unmute-button .mute-icon { display: none; }
        .unmute-button.muted .mute-icon { display: inline-block; }
        .unmute-button.muted .unmute-icon { display: none; }
        .unmute-button:not(.muted) .mute-icon { display: none; }
        .unmute-button:not(.muted) .unmute-icon { display: inline-block; }

        /* Scrolling Text Container */
        .scrolling-text-container {
            position: absolute; /* Position relative to .video-container */
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px; /* Height of the ticker */
            background-color: red; /* Red background */
            overflow: hidden; /* Hide text outside this band */
            z-index: 15; /* Above video, below unmute button */
            display: flex;
            align-items: center; /* Vertically center the text */
            white-space: nowrap; /* Prevent text from wrapping */
            box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.3); /* Subtle shadow above ticker */
        }

        .scrolling-text {
            color: white; /* White text */
            font-size: 1.2em; /* Adjust font size */
            font-weight: bold;
            padding-left: 100%; /* Start text off-screen to the right */
            animation: scroll-left 40s linear infinite; /* Animation duration and loop */
        }

        /* Keyframe animation for scrolling */
        @keyframes scroll-left {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-100%); } /* Scrolls its own width left */
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .tv-container {
                width: 95%;
            }

            .unmute-button {
                top: 10px;
                right: 10px;
                padding: 10px;
                font-size: 3.0em; /* Adjusted for smaller screens */
            }

            .scrolling-text-container {
                height: 30px; /* Smaller height on smaller screens */
            }

            .scrolling-text {
                font-size: 1em;
                animation-duration: 30s; /* Faster scroll on smaller screens */
            }
        }

        @media (max-width: 480px) {
            .tv-container {
                width: 100%;
                border-radius: 0;
            }
            .unmute-button {
                top: 5px;
                right: 5px;
                padding: 8px;
                font-size: 2.0em; /* Adjusted for very small screens */
            }

            .scrolling-text-container {
                height: 25px;
            }

            .scrolling-text {
                font-size: 0.9em;
                animation-duration: 25s;
            }
        }
    </style>
</head>
<body>

    <div class="tv-container">
        <div class="video-container">
            <div id="player"></div>
            <div class="video-overlay"></div> 
            <button id="unmuteButton" class="unmute-button muted">
                <span class="mute-icon">ðŸ”‡</span>
                <span class="unmute-icon">ðŸ”Š</span>
            </button>

            <div class="scrolling-text-container">
                <div class="scrolling-text" id="newsTicker">
                    Welcome to My Live TV Channel! Tune in 24/7 for great content. Stay tuned for exciting upcoming programs! This is a demo of scrolling text.
                    Â Â Â Â Â Â Â Â Â Â Â Â Â  Breaking News: Live broadcast continues! Â Â Â Â Â Â Â Â Â Â Â Â Â  
                    Remember to unmute for sound! Â Â Â Â Â Â Â Â Â Â Â Â Â  
                    Enjoy the show!
                </div>
            </div>
        </div>
    </div>

    <script>
        // Helper function to parse various YouTube URLs/IDs
        // This function enables flexible URLs in your playlist.
        function parseYouTubeLink(link) {
            const videoRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
            const playlistRegex = /(?:youtube\.com\/(?:playlist\?list=|embed\/videoseries\?list=))([a-zA-Z0-9_-]+)/;
            const googleUserContentVideoRegex = /googleusercontent\.com\/youtube\.com\/([a-zA-Z0-9_-]{11})/;
            const googleUserContentPlaylistRegex = /googleusercontent\.com\/youtube\.com\/playlist\?list=([a-zA-Z0-9_-]+)/;

            let match;

            match = link.match(playlistRegex);
            if (match && match[1]) return { type: 'playlist', id: match[1] };
            match = link.match(googleUserContentPlaylistRegex);
            if (match && match[1]) return { type: 'playlist', id: match[1] };

            match = link.match(videoRegex);
            if (match && match[1]) return { type: 'video', id: match[1] };
            match = link.match(googleUserContentVideoRegex);
            if (match && match[1]) return { type: 'video', id: match[1] };

            if (link.length === 11 && /^[a-zA-Z0-9_-]+$/.test(link)) {
                return { type: 'video', id: link };
            }

            console.warn(`Unrecognized YouTube link format: ${link}`);
            return null;
        }

        // --- YOUR 24/7 CONTINUOUS PLAYLIST ---
        // Each video in this list will play for exactly VIDEO_SLOT_DURATION seconds.
        const youtubePlaylist = [
            '17LL_iqlHE8', // Example: Rick Astley
            'xHs7aUUOlJo', // Example: Lofi Hip Hop Radio
            'LXb3EKWsInQ', // Example: Epic Nature Documentary
            'k-LgJ52aU5Y', // Example: Cozy Fireplace Sounds
            'v7LqS6G0y4Q', // Another example video
            // Add more video IDs or full URLs here, e.g., 'http://googleusercontent.com/youtube.com/dQw4w9WgXcQ'
            // NOTE: Playlist URLs (list=...) will *not* work with the fixed 2-minute duration.
            // They would play the entire playlist, overriding the 2-minute cut-off logic.
            // For 2-minute slots, use individual video IDs or URLs only.
        ];

        // --- CONFIGURATION FOR VIDEO SLOTS ---
        const VIDEO_SLOT_DURATION_SECONDS = 120; // 2 minutes (120 seconds)

        // Global state variables
        const LAST_PLAYED_KEY = 'lastPlayedVideo';
        let currentVideoIndex = 0;
        let player;
        let saveInterval; // For saving last played position
        let videoTimeout; // To force video change after 2 minutes

        const unmuteButton = document.getElementById('unmuteButton');
        const newsTicker = document.getElementById('newsTicker');

        // Function to load the current item from the playlist
        function loadPlaylistItem() {
            if (youtubePlaylist.length === 0) {
                console.error("YouTube playlist is empty. Please add video/playlist URLs or IDs.");
                return;
            }

            if (currentVideoIndex >= youtubePlaylist.length) {
                currentVideoIndex = 0; // Loop back to the beginning
            }

            const itemToPlay = youtubePlaylist[currentVideoIndex];
            const parsedItem = parseYouTubeLink(itemToPlay);

            if (parsedItem && parsedItem.type === 'video') { // Only allow video types for timed slots
                console.log(`Loading video: ${parsedItem.id}`);
                
                // If returning from localStorage, start at saved time
                const lastPlayed = JSON.parse(localStorage.getItem(LAST_PLAYED_KEY));
                let startTime = 0;
                if (lastPlayed && lastPlayed.index === currentVideoIndex) {
                    startTime = lastPlayed.time;
                }
                
                player.loadVideoById(parsedItem.id, startTime);
                
                // Clear any existing timeout and set a new one for 2 minutes
                clearTimeout(videoTimeout);
                videoTimeout = setTimeout(() => {
                    console.log(`2-minute slot ended for ${parsedItem.id}. Moving to next video.`);
                    currentVideoIndex++; // Move to next video
                    loadPlaylistItem(); // Load it
                }, VIDEO_SLOT_DURATION_SECONDS * 1000); // Convert seconds to milliseconds

            } else {
                console.error(`Skipping invalid or non-video item in playlist at index ${currentVideoIndex}: ${itemToPlay}. Moving to next.`);
                currentVideoIndex++;
                loadPlaylistItem(); // Try loading the next item
            }
            player.mute(); // Ensure new content starts muted
            unmuteButton.classList.add('muted');
        }

        // This function creates an <iframe> (and YouTube player)
        // after the API code downloads.
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '390', // Default height (will be overridden by CSS)
                width: '640',  // Default width (will be overridden by CSS)
                // videoId will be set in onPlayerReady by loadPlaylistItem
                playerVars: {
                    'autoplay': 1,      // Autoplay the video (will be muted due to browser policy)
                    'controls': 0,      // Hide all default controls (seek bar, timestamp, etc.)
                    'disablekb': 1,     // Disable keyboard controls
                    'autohide': 1,      // Hide controls when idle (though they are already hidden)
                    'modestbranding': 1, // Remove YouTube logo on control bar
                    'rel': 0,           // Do not show related videos at the end
                    'iv_load_policy': 3 // Do not show video annotations
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError // Add error handling
                }
            });
        }

        // The API will call this function when the video player is ready.
        function onPlayerReady(event) {
            // Attempt to load previous state from localStorage
            const lastPlayed = JSON.parse(localStorage.getItem(LAST_PLAYED_KEY));
            if (lastPlayed && youtubePlaylist[lastPlayed.index]) {
                currentVideoIndex = lastPlayed.index;
            } else {
                currentVideoIndex = 0; // Start from the beginning if no saved state
            }
            
            loadPlaylistItem(); // Load the determined item

            player.mute(); // Mute the player initially to comply with autoplay policies
            unmuteButton.classList.add('muted'); // Ensure button reflects muted state

            // Start periodically saving current time to localStorage
            saveInterval = setInterval(() => {
                if (player && player.getCurrentTime) {
                    localStorage.setItem(LAST_PLAYED_KEY, JSON.stringify({
                        index: currentVideoIndex,
                        time: player.getCurrentTime()
                    }));
                }
            }, 5000); // Save every 5 seconds
        }

        // The API calls this function when the player's state changes.
        function onPlayerStateChange(event) {
            // If the video has naturally ended (before the 2-minute timeout), play the next one
            if (event.data === YT.PlayerState.ENDED) {
                console.log(`Video naturally ended. Moving to next.`);
                clearTimeout(videoTimeout); // Clear timeout as video ended early
                currentVideoIndex++;
                loadPlaylistItem();
            }
            // If the video started playing, ensure timeout is running.
            else if (event.data === YT.PlayerState.PLAYING) {
                 // Reset timeout if video resumes playing (e.g., after buffering)
                 clearTimeout(videoTimeout);
                 videoTimeout = setTimeout(() => {
                     console.log(`2-minute slot ended (PlayerState.PLAYING) for current video. Moving to next.`);
                     currentVideoIndex++; // Move to next video
                     loadPlaylistItem(); // Load it
                 }, VIDEO_SLOT_DURATION_SECONDS * 1000 - player.getCurrentTime() * 1000); // Remaining time
            }
        }

        // Handle player errors (e.g., video not found, private video, playback issue)
        function onPlayerError(event) {
            console.error('YouTube Player Error:', event.data, 'Attempting to skip to next item.');
            clearTimeout(videoTimeout); // Clear timeout for the errored video
            currentVideoIndex++; // Skip the problematic video
            loadPlaylistItem(); // Load the next one
        }

        // Unmute button functionality
        unmuteButton.addEventListener('click', () => {
            if (player.isMuted()) {
                player.unMute();
                unmuteButton.classList.remove('muted');
            } else {
                player.mute();
                unmuteButton.classList.add('muted');
            }
        });

        // Load the IFrame Player API asynchronously.
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api"; // Standard YouTube API script URL
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // Clear intervals and timeouts when the page is about to be unloaded
        window.addEventListener('beforeunload', () => {
            clearInterval(saveInterval);
            clearTimeout(videoTimeout);
        });
    </script>

</body>
</html>
