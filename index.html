<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <title>MSTV Live</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #000;
      color: #fff;
      text-align: center;
    }
    .title {
      font-size: 2rem;
      font-weight: bold;
      color: gold;
      margin: 1rem 0 0;
      text-shadow: 0 0 10px gold;
    }
    .golden-scroll {
      color: orange;
      font-weight: bold;
      margin-bottom: 1rem;
    }
    .now-playing {
      font-size: 1.1rem;
      margin: 0.5rem 0;
    }
    .player-container {
      width: 90%;
      max-width: 720px;
      margin: 1rem auto;
      aspect-ratio: 16 / 9;
      position: relative;
      background: #111;
      border: 3px solid gold;
      border-radius: 16px;
      overflow: hidden;
    }
    video, #ytPlayer {
      width: 100%;
      height: 100%;
    }
    #ytPlayer {
      display: none;
    }
    .tv-guide {
      margin-top: 1rem;
    }
    #tvGuideList li {
      list-style: none;
      margin: 4px 0;
    }
    #tvGuideList li.active {
      color: yellow;
      font-weight: bold;
    }
    .off-air {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000c;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
      z-index: 10;
    }
    footer {
      margin: 2rem 0;
      font-size: 0.8rem;
      color: #aaa;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
  <h1 class="title">MSTV NETWORK</h1>
  <marquee class="golden-scroll">ðŸ”¥ Welcome to MSTV | Live Streaming | Entertainment | News | Music ðŸ”¥</marquee>

  <div class="now-playing" id="nowPlaying">Now Playing: Loading...</div>
  <div style="font-size: 0.9rem; color: #ccc;">Melbourne Time: <span id="melNow">loading...</span></div>

  <div class="player-container" id="playerContainer">
    <video id="hlsPlayer" controls muted autoplay style="display:none;" playsinline></video>
    <div id="ytPlayer"></div>
    <div class="off-air" id="offAir">ðŸ”Œ Off Air</div>
  </div>

  <section class="tv-guide">
    <h2>ðŸ“º TV Guide</h2>
    <ul id="tvGuideList"></ul>
  </section>

  <footer>
    Â© 2025 MSTV Network. All rights reserved.
  </footer>

  <script>
    const hlsPlayer = document.getElementById('hlsPlayer');
    const ytContainer = document.getElementById('ytPlayer');
    const offAir = document.getElementById('offAir');
    const nowPlaying = document.getElementById('nowPlaying');
    const tvGuideList = document.getElementById('tvGuideList');
    const playerContainer = document.getElementById('playerContainer');
    let currentIndex = -1;
    let ytPlayer;

    const sources = [
  { title: "Morning News", url: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8" },
  { title: "Cafe Jazz Live (YouTube)", url: "https://www.youtube.com/watch?v=Dx5qFachd3A" },
  { title: "Nature Documentary", url: "https://test-streams.mux.dev/test_001/stream.m3u8" },
  { title: "Live DJ Set (YouTube)", url: "https://www.youtube.com/watch?v=jfKfPfyJRdk" },
  { title: "World Report", url: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8" },
  { title: "Music Hour (YT)", url: "https://www.youtube.com/watch?v=DWcJFNfaw9c" }
];


    function generateSchedule() {
      const schedule = [];
      const now = luxon.DateTime.now().setZone('Australia/Melbourne').startOf('day');
      for (let i = 0; i < 24; i++) {
        const start = now.plus({ hours: i });
        const end = start.plus({ hours: 1 });
        const item = sources[i % sources.length];
        schedule.push({
          title: item.title,
          url: item.url,
          start: start.toISO(),
          end: end.toISO()
        });
      }
      return schedule;
    }

    const playlist = generateSchedule();

    function updateNowPlaying() {
      const now = luxon.DateTime.now().setZone('Australia/Melbourne');
      document.getElementById('melNow').textContent = now.toFormat('HH:mm:ss');

      let foundIndex = -1;
      playlist.forEach((item, i) => {
        const start = luxon.DateTime.fromISO(item.start).setZone('Australia/Melbourne');
        const end = luxon.DateTime.fromISO(item.end).setZone('Australia/Melbourne');
        if (now >= start && now < end) {
          foundIndex = i;
        }
      });

      if (foundIndex !== currentIndex) {
        currentIndex = foundIndex;
        if (foundIndex === -1) {
          showOffAir();
        } else {
          playSegment(playlist[foundIndex]);
        }
        buildGuide();
      }
    }

    function buildGuide() {
      tvGuideList.innerHTML = "";
      playlist.forEach((item, i) => {
        const start = luxon.DateTime.fromISO(item.start).setZone('Australia/Melbourne');
        const time = start.toFormat('HH:mm');
        const li = document.createElement('li');
        li.textContent = `${time} - ${item.title}`;
        if (i === currentIndex) li.classList.add("active");
        tvGuideList.appendChild(li);
      });
    }

    function showOffAir() {
      nowPlaying.textContent = "Now Playing: Off Air";
      offAir.style.display = "flex";
      hlsPlayer.style.display = "none";
      ytContainer.style.display = "none";
      if (ytPlayer) ytPlayer.destroy();
    }

    function playSegment(item) {
      nowPlaying.textContent = `Now Playing: ${item.title}`;
      offAir.style.display = "none";
      const start = luxon.DateTime.fromISO(item.start).setZone('Australia/Melbourne');
      const now = luxon.DateTime.now().setZone('Australia/Melbourne');
      const seekTo = Math.floor(now.diff(start, 'seconds').seconds);

      if (item.url.includes("youtube.com")) {
        playYouTube(item.url, seekTo);
      } else {
        playHLS(item.url, seekTo);
      }
    }

    function playHLS(url, seekTo) {
      if (ytPlayer) {
        ytPlayer.destroy();
        ytContainer.innerHTML = "";
      }
      ytContainer.style.display = "none";
      hlsPlayer.style.display = "block";
      if (hlsPlayer.canPlayType("application/vnd.apple.mpegurl")) {
        hlsPlayer.src = url;
        hlsPlayer.currentTime = seekTo;
        hlsPlayer.play();
      } else if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(hlsPlayer);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          hlsPlayer.currentTime = seekTo;
          hlsPlayer.play();
        });
      }
    }

    function playYouTube(url, seekTo) {
      hlsPlayer.pause();
      hlsPlayer.style.display = "none";
      ytContainer.style.display = "block";
      const videoId = new URL(url).searchParams.get("v") || url.split("/").pop();
      ytPlayer = new YT.Player("ytPlayer", {
        height: "100%",
        width: "100%",
        videoId,
        playerVars: {
          autoplay: 1,
          mute: 1,
          start: seekTo,
          controls: 1,
          modestbranding: 1,
          playsinline: 1
        },
        events: {
          onReady: e => e.target.playVideo()
        }
      });
    }

    setInterval(updateNowPlaying, 15000);
    window.onload = updateNowPlaying;
  </script>
</body>
</html>
