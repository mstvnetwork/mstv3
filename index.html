<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>MSTV LIVE TEST</title>
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      font-family: sans-serif;
    }
    #player-container {
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 9;
      background: #000;
    }
    #click-overlay {
      position: absolute;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      color: white;
      font-size: 1.5em;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2;
      cursor: pointer;
    }
    #scrolling-text {
      position: absolute;
      bottom: 0;
      width: 100%;
      background: red;
      color: white;
      font-size: 1rem;
      padding: 5px 0;
      white-space: nowrap;
      overflow: hidden;
      z-index: 3;
    }
    #scrolling-text::after {
      content: attr(data-text);
      display: inline-block;
      padding-left: 100%;
      animation: scrollText 15s linear infinite;
    }
    @keyframes scrollText {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
    iframe, video {
      width: 100%;
      height: 100%;
      border: none;
    }
  </style>
</head>
<body>

<div id="player-container">
  <div id="click-overlay">Click to Play Channel ‚ñ∂Ô∏è</div>
  <div id="player"></div>
  <div id="scrolling-text" data-text="üì¢ MSTV is Live 24/7 ‚Äî Enjoy the show! üé¨üì∞">üì¢ MSTV is Live 24/7 ‚Äî Enjoy the show! üé¨üì∞</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://www.youtube.com/iframe_api"></script>
<script>
const testPlaylist = [
  {
    "type": "youtube",
    "url": "dQw4w9WgXcQ",  // public YouTube video ID
    "startTime": "00:00",
    "endTime": "23:59"
  },
  {
    "type": "hls",
    "url": "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",
    "startTime": "00:00",
    "endTime": "23:59"
  }
];

let player;

document.getElementById("click-overlay").addEventListener("click", () => {
  document.getElementById("click-overlay").style.display = "none";
  loadCurrentVideo();
});

function getCurrentUTCSeconds() {
  const now = new Date();
  return now.getUTCHours() * 3600 + now.getUTCMinutes() * 60 + now.getUTCSeconds();
}

function timeToSeconds(t) {
  const [h, m] = t.split(":").map(Number);
  return h * 3600 + m * 60;
}

function loadCurrentVideo() {
  const nowSec = getCurrentUTCSeconds();
  const current = testPlaylist.find(item => {
    const start = timeToSeconds(item.startTime);
    const end = timeToSeconds(item.endTime);
    return nowSec >= start && nowSec < end;
  });

  if (!current) {
    showOffAir();
    return;
  }

  const offset = nowSec - timeToSeconds(current.startTime);
  console.log("Now Playing:", current, "Offset:", offset);
  if (current.type === "youtube") {
    playYouTube(current.url, offset);
  } else if (current.type === "hls") {
    playHLS(current.url, offset);
  }
}

function playYouTube(videoId, offset) {
  const container = document.getElementById("player");
  container.innerHTML = "";
  player = new YT.Player("player", {
    videoId: videoId,
    playerVars: {
      autoplay: 1,
      controls: 0,
      disablekb: 1,
      fs: 0,
      modestbranding: 1,
      rel: 0,
      start: offset,
      mute: 1 // force mute to allow autoplay
    },
    events: {
      onReady: e => e.target.playVideo()
    }
  });
}

function playHLS(url, offset) {
  const container = document.getElementById("player");
  container.innerHTML = "";
  const video = document.createElement("video");
  video.setAttribute("playsinline", "");
  video.setAttribute("autoplay", "");
  video.setAttribute("muted", "true");
  video.controls = false;
  container.appendChild(video);

  if (Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      video.currentTime = offset;
      video.play();
    });
  } else {
    video.src = url;
    video.currentTime = offset;
    video.play();
  }
}

function showOffAir() {
  const container = document.getElementById("player");
  container.innerHTML = "<div style='color:white;padding:20px;text-align:center;'>Currently Off Air</div>";
}
</script>
</body>
</html>
