<!DOCTYPE html>
<html>
<head>
  <title>Multi-Source Playlist Player</title>
  <style>
    body { background: #000; color: white; text-align: center; font-family: sans-serif; }
    #playerContainer, video { width: 90%; max-width: 800px; margin: auto; border: 3px solid gold; border-radius: 16px; }
    #nextBtn { margin-top: 15px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>

<h2>MSTV Playlist Player</h2>
<div id="playerContainer">
  <div id="ytPlayer"></div>
  <video id="hlsPlayer" controls style="display:none;"></video>
</div>
<button id="nextBtn">Next</button>

<script src="https://www.youtube.com/iframe_api"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
const playlist = [
  { type: "youtube", url: "https://www.youtube.com/watch?v=Gnef-jGl2zM&list=PLYIexFLR0T0mkUsnZ1jK08Lt8--owBp6g" },
  { type: "youtube", url: "https://www.youtube.com/watch?v=CRFZq2xJKCE" },
  { type: "hls", url: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8" }
];

let currentIndex = 0;
let ytPlayer;
let hls;
let videoEl = document.getElementById('hlsPlayer');

function loadVideo(index) {
  const item = playlist[index];
  if (!item) return;

  if (item.type === 'youtube') {
    videoEl.style.display = 'none';
    videoEl.pause();
    if (ytPlayer) {
      const videoId = new URL(item.url).searchParams.get('v');
      ytPlayer.loadVideoById(videoId);
    }
  } else if (item.type === 'hls') {
    document.getElementById('ytPlayer').innerHTML = '';
    videoEl.style.display = 'block';
    if (hls) hls.destroy();
    hls = new Hls();
    hls.loadSource(item.url);
    hls.attachMedia(videoEl);
    hls.on(Hls.Events.MANIFEST_PARSED, function () {
      videoEl.play();
    });
  }
}

function nextVideo() {
  currentIndex++;
  if (currentIndex >= playlist.length) currentIndex = 0; // Loop
  loadVideo(currentIndex);
}

document.getElementById('nextBtn').addEventListener('click', nextVideo);

// YouTube API will call this
function onYouTubeIframeAPIReady() {
  ytPlayer = new YT.Player('ytPlayer', {
    height: '360',
    width: '640',
    videoId: new URL(playlist[0].url).searchParams.get('v'),
    events: {
      'onReady': () => ytPlayer.playVideo(),
      'onStateChange': (event) => {
        if (event.data === YT.PlayerState.ENDED) nextVideo();
      }
    }
  });
}

// Autoplay first video
window.onload = () => loadVideo(0);
</script>

</body>
</html>
